# Default config for sway
# Copy this to ~/.config/sway/config

### Variables
set $mod Mod4
set $left h
set $down j
set $up k
set $right l
set $term ghostty

# --- ROFI REPLACEMENT ---
# We use 'combi' mode to show Apps (drun) and Calculator (calc) in one list
set $menu rofi -show combi -no-persist-history
# ------------------------

set $browser helium-browser
set $wallpaper /home/alaeddine/Pictures/Wallpapers/ashya-jamila.jpg


# Colors
set $bg-color            #000000
set $inactive-bg-color   #222222
set $text-color          #ffffff
set $inactive-text-color #888888
set $urgent-bg-color     #8c001a
set $border-color        #000000


# Window Colors
# class                 border           background           text                 indicator         child_border
client.focused          $border-color    $bg-color            $text-color          $border-color     $border-color
client.focused_inactive $inactive-bg-color $inactive-bg-color $inactive-text-color $inactive-bg-color $inactive-bg-color
client.unfocused        $inactive-bg-color $inactive-bg-color $inactive-text-color $inactive-bg-color $inactive-bg-color
client.urgent           $urgent-bg-color $urgent-bg-color     $text-color          $urgent-bg-color $urgent-bg-color

# Global Font
font pango:JetBrainsMono Nerd Font Mono 11

### Output & Autostart
output * bg $wallpaper fill
# Asahi Mac Resolution/Scale
output eDP-1 scale 1.5 resolution 2560x1600 pos 0 0


# Essential Daemons

# 1. Clipboard History (Store Text and Images separately for stability)
exec wl-paste --type text --watch cliphist store
exec wl-paste --type image --watch cliphist store

# 2. Clipboard Persistence (Fixes the "Empty Paste" bug)
exec wl-clip-persist --clipboard regular


exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=sway

exec swayidle -w \
    timeout 300 'swaylock -f --screenshots --clock --indicator --effect-scale 0.5 --effect-blur 7x5 --effect-scale 2' \
    timeout 600 'swaymsg "output * power off"' \
    resume 'swaymsg "output * power on"' \
    before-sleep 'swaylock -f --screenshots --clock --indicator --effect-scale 0.5 --effect-blur 7x5 --effect-scale 2'

### Input Configuration (Asahi/Mac)
input type:touchpad {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
}

input "type:keyboard" {
    xkb_layout "us,ma"
    xkb_variant "mac,"
    xkb_options "grp:alt_shift_toggle"
    # Options:
    # 1. grp:alt_shift_toggle (Switch layout)
    # 2. lv3:ralt_alt (Right Option as Alt)
    # 3. caps:escape (Caps Lock behaves as Escape)
    xkb_options "grp:alt_shift_toggle,lv3:ralt_alt,caps:escape"
}

### Layout Settings
# Sets new workspaces to be tabbed by default
workspace_layout tabbed

# Use Pixel borders (Clean look)
default_border pixel 0

### Key bindings
#
# Basics
#
    # Terminal
    bindsym $mod+Return exec $term

    # Launcher (Rofi) -> Mod+Space
    bindsym $mod+Space exec $menu

    # Kill Window
    bindsym $mod+q kill

    # Browser
    bindsym $mod+b exec $browser

    # Reload / Exit
    bindsym $mod+Shift+c reload
    bindsym $mod+Shift+e exec swaynag -t warning -m 'Exit Sway?' -B 'Yes' 'swaymsg exit'

#
# Floating & Focus (Niri Style)
#
    # Toggle Floating Mode -> Mod+Shift+Space
    bindsym $mod+Shift+space floating toggle

    # Switch Focus between Tiling and Floating area -> Mod+Shift+v
    bindsym $mod+Shift+v focus mode_toggle

    # Drag floating windows with mouse
    floating_modifier $mod normal

#
# Clipboard (Rofi Integration)
#
    # Mod+v -> Open Clipboard History using Rofi in dmenu mode
    bindsym $mod+v exec cliphist list | rofi -dmenu -p "Clipboard" -theme-str 'window {width: 50%;}' | cliphist decode | wl-copy

#
# TUI Apps & Scripts
#
    bindsym $mod+Alt+b exec foot --title "Bluetooth TUI" bluetui
    bindsym $mod+Alt+w exec foot --title "Wifi TUI" impala
    bindsym $mod+Shift+BackSpace exec foot --title "Task Manager" btop
    bindsym $mod+Alt+s exec foot --title "Sound TUI" wiremix --max-volume-percent 100

    # Lock Screen
    bindsym $mod+Alt+l exec swaylock -f --screenshots --clock --indicator --effect-scale 0.5 --effect-blur 7x5 --effect-scale 2

#
# Moving Focus
#
    bindsym $mod+$left focus left
    bindsym $mod+$down focus down
    bindsym $mod+$up focus up
    bindsym $mod+$right focus right
    bindsym $mod+Left focus left
    bindsym $mod+Down focus down
    bindsym $mod+Up focus up
    bindsym $mod+Right focus right

#
# Moving Windows
#
    bindsym $mod+Shift+$left move left
    bindsym $mod+Shift+$down move down
    bindsym $mod+Shift+$up move up
    bindsym $mod+Shift+$right move right
    bindsym $mod+Shift+Left move left
    bindsym $mod+Shift+Down move down
    bindsym $mod+Shift+Up move up
    bindsym $mod+Shift+Right move right

#
# Trackpad Gestures
#
    # 3 Fingers: Switch Tabs
    bindgesture swipe:3:right focus prev
    bindgesture swipe:3:left  focus next
    # 4 Fingers: Switch Workspaces
    bindgesture swipe:4:left  workspace next
    bindgesture swipe:4:right workspace prev

#
# Workspaces
#
    bindsym $mod+1 workspace number 1
    bindsym $mod+2 workspace number 2
    bindsym $mod+3 workspace number 3
    bindsym $mod+4 workspace number 4
    bindsym $mod+5 workspace number 5
    bindsym $mod+6 workspace number 6
    bindsym $mod+7 workspace number 7
    bindsym $mod+8 workspace number 8
    bindsym $mod+9 workspace number 9
    bindsym $mod+0 workspace number 10

    bindsym $mod+Shift+1 move container to workspace number 1
    bindsym $mod+Shift+2 move container to workspace number 2
    bindsym $mod+Shift+3 move container to workspace number 3
    bindsym $mod+Shift+4 move container to workspace number 4
    bindsym $mod+Shift+5 move container to workspace number 5
    bindsym $mod+Shift+6 move container to workspace number 6
    bindsym $mod+Shift+7 move container to workspace number 7
    bindsym $mod+Shift+8 move container to workspace number 8
    bindsym $mod+Shift+9 move container to workspace number 9
    bindsym $mod+Shift+0 move container to workspace number 10

#
# Layout Manipulation
#
    # bindsym $mod+b splith
    # bindsym $mod+v splitv
    bindsym $mod+s layout stacking
    bindsym $mod+w layout tabbed
    bindsym $mod+e layout toggle split
    bindsym $mod+f fullscreen
    bindsym $mod+a focus parent

#
# Scratchpad
#
    bindsym $mod+Shift+minus move scratchpad
    bindsym $mod+minus scratchpad show

#
# Window Rules (Floating Apps)
#
    for_window [app_id="foot" title="Bluetooth TUI"] floating enable, resize set 800 600
    for_window [app_id="foot" title="Wifi TUI"] floating enable, resize set 800 600
    for_window [app_id="foot" title="Task Manager"] floating enable, resize set 1500 800
    for_window [app_id="foot" title="Sound TUI"] floating enable, resize set 800 600

    for_window [title="^Picture-in-Picture$"] floating enable, sticky enable

#
# Resize Mode
#
mode "resize" {
    bindsym $left resize shrink width 10px
    bindsym $down resize grow height 10px
    bindsym $up resize shrink height 10px
    bindsym $right resize grow width 10px
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

#
# Hardware Controls (Asahi/Mac)
#
    # Volume
    bindsym --locked XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle
    bindsym --locked XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5%
    bindsym --locked XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5%
    bindsym --locked XF86AudioMicMute exec pactl set-source-mute @DEFAULT_SOURCE@ toggle

    # Brightness
    bindsym --locked XF86MonBrightnessDown exec brightnessctl set 5%-
    bindsym --locked XF86MonBrightnessUp exec brightnessctl set 5%+
    bindsym --locked XF86KbdBrightnessDown exec brightnessctl --device='*kbd_backlight' set 5%-
    bindsym --locked XF86KbdBrightnessUp exec brightnessctl --device='*kbd_backlight' set 5%+

    # Screenshot
    bindsym $mod+p exec grim ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S.png')
    bindsym $mod+shift+p exec grim -g "$(slurp)" ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S.png')

    # Color picker
    bindsym $mod+c exec grim -g "$(slurp -p)" -t ppm - | convert - -format '%[pixel:p{0,0}]' txt:- | tail -n 1 | cut -d ' ' -f 4 | wl-copy

    # Power Menu
    bindsym $mod+Shift+q exec ~/.local/bin/power-menu.sh

#
# Status Bar
#
bar {
    position bottom

    font pango:JetBrainsMono Nerd Font Propo 11

    # status_command executes your shell script
    status_command ~/.config/sway/status.sh

    # No 'colors' block = Use Sway Defaults (Blue/Grey)
    colors {
        background $bg-color
        separator  $border-color
        statusline $text-color

        # State                 Border           BG               Text
        focused_workspace   $border-color    $border-color    $text-color
        active_workspace    $inactive-bg-color $inactive-bg-color $text-color
        inactive_workspace  $bg-color        $bg-color        $inactive-text-color
        urgent_workspace    $urgent-bg-color $urgent-bg-color $text-color
    }
}

include /etc/sway/config.d/*
