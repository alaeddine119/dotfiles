#!/bin/bash

# Check if recording is already running
if pgrep -x "wf-recorder" >/dev/null; then
    # If running, show "Stop" option
    # Rofi: -dmenu mode, custom prompt, and constrained window size
    CHOICE=$(echo -e "‚èπÔ∏è Stop Recording" | rofi -dmenu -p "Recording Active" -theme-str 'window {width: 25%;} listview {lines: 1;}')

    if [[ "$CHOICE" == "‚èπÔ∏è Stop Recording" ]]; then
        killall -s SIGINT wf-recorder
        notify-send "Recording Saved" "Video saved to ~/Videos"
    fi
else
    # If not running, show Start options
    CHOICE=$(echo -e "üñ•Ô∏è Full Screen (No Audio)\nüîä Full Screen (With Audio)\n‚úÇÔ∏è Select Region (No Audio)" | rofi -dmenu -p "Start Recording" -theme-str 'window {width: 30%;} listview {lines: 3;}')

    TIMESTAMP=$(date +'%Y-%m-%d_%H-%M-%S')
    FILENAME="$HOME/Videos/Rec_$TIMESTAMP.mp4"

    case "$CHOICE" in
        "üñ•Ô∏è Full Screen (No Audio)")
            notify-send "Recording Started" "Full Screen"
            wf-recorder -f "$FILENAME" &
            ;;
        "üîä Full Screen (With Audio)")
            notify-send "Recording Started" "With Audio"
            # Uses default audio source automatically
            wf-recorder -a -f "$FILENAME" &
            ;;
        "‚úÇÔ∏è Select Region (No Audio)")
            notify-send "Select Region" "Draw a box to record"
            wf-recorder -g "$(slurp)" -f "$FILENAME" &
            ;;
    esac
fi
